{% extends "base.html" %}

{% block title %}Chat - PDF Chatbot{% endblock %}

{% block content %}
<div class="flex h-[calc(100vh-4rem)]">
    <!-- PDF Viewer -->
    <div class="w-1/2 bg-white p-4 border-r">
        <iframe src="/pdf/view/{{ pdf.file_id }}" class="w-full h-full border-0" title="PDF Viewer">
        </iframe>
    </div>

    <!-- Chat Interface -->
    <div class="w-1/2 flex flex-col bg-gray-50">
        <!-- Chat Messages -->
        <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-4"
            hx-get="/api/chat/{{ pdf.file_id }}/messages" hx-trigger="load, newMessage from:body" hx-swap="innerHTML">
            {% for message in messages %}
            <div class="flex {% if message.role == 'user' %}justify-end{% endif %}">
                <div
                    class="max-w-[70%] {% if message.role == 'user' %}bg-indigo-600 text-white{% else %}bg-white{% endif %} rounded-lg px-4 py-2 shadow">
                    <p class="text-sm">{{ message.content }}</p>
                    {% if message.role == 'assistant' and message.sources %}
                    <div class="mt-2 text-xs text-gray-500">
                        <p>Sources:</p>
                        {% for source in message.sources %}
                        <p>Page {{ source.page_number }}: {{ source.text_preview }}</p>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Chat Input -->
        <div class="border-t bg-white p-4">
            <form hx-post="/api/chat/{{ pdf.file_id }}/send" hx-trigger="submit" hx-target="#chat-messages"
                hx-swap="beforeend" class="flex space-x-2">
                <input type="text" name="message"
                    class="flex-1 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
                    placeholder="Type your message..." required>
                <button type="submit"
                    class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Send
                </button>
            </form>
        </div>
    </div>
</div>
{% endblock %}